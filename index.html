<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸–ç´€é«®å»Š æ™¯ç¾åº—</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@5.11.5/main.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
<style>
/* =====CSSè®Šæ•¸å®šç¾©å€å¡Š - çµ±ä¸€ç®¡ç†æ•´å€‹ç¶²ç«™çš„é¡è‰²é…ç½® =====*/
:root {
  /* å“ç‰Œä¸»è‰²ç³»ï¼ˆä¸»è¦/è¼ƒäº®/è¼ƒæ·±/æ¥µæ·ºèƒŒæ™¯ï¼‰ */
  --kikyo-primary: #5D4E75;      /* ä¸»è¦è‰²ï¼Œç”¨åœ¨æ¨™é¡Œåˆ—ã€é‡é»æŒ‰éˆ• */
  --kikyo-light:   #8B7CA3;      /* è¼ƒäº®é»ç¶´ */
  --kikyo-dark:    #4A3D5C;      /* è¼ƒæ·±å°æ¯” */
  --kikyo-ultra-light: #F5F3F8;  /* è¶…æ·ºåº•è‰²ï¼ˆå€å¡ŠèƒŒæ™¯ï¼‰ */
  /* è¼”åŠ©è‰²ï¼ˆå¡ç‰‡åº•/é–“éš”ç”¨ï¼Œå¯è‡ªè¡Œæ›¿æ›ï¼‰ */
  --accent-cream:    #f8f4fc;    /* æ™‚æ®µå¶æ•¸åˆ—èƒŒæ™¯ */
  --accent-lavender: #E6E0F0;
  /* æ–‡å­—è‰²ç³» */
  --text-light:     #ffffff;     /* æ·±åº•ä¸Šçš„ç™½å­— */--text-muted:     #c9b8b8;     /* è¨»è§£/ç°å­— */
  /* å…¨ç«™èƒŒæ™¯èˆ‡å¡ç‰‡ */
  --bg-main:  linear-gradient(135deg, #F8F6FB 0%, #EDE7F6 100%);
  --bg-card:  #FfffFF;
  --bg-active: var(--kikyo-ultra-light);
  /* æ¡†ç·š/é™°å½±/åœ“è§’ */
  --calendar-border:       #E0D4E8;
  --border-radius:       5px;  /* å¡ç‰‡åœ“è§’ */
  --border-radius-small: 5px;   /* å°å‹å…ƒä»¶åœ“è§’ */
  --shadow-soft:   0 4px 8px  rgba(93,78,117,0.1);
  --shadow-medium: 0 8px 16px rgba(93,78,117,0.15);

  /* å½ˆçª— */
  --modal-overlay: rgba(93,78,117,0.6);
  --modal-bg:      var(--bg-card);
  --modal-border:  var(--calendar-border);
}

/* ==================== ğŸŒ åŸºç¤æ¨£å¼ ==================== */
/* å…¨åŸŸåŸºç¤è¨­å®š - é‡ç½®ç€è¦½å™¨é è¨­æ¨£å¼ä¸¦è¨­å®šåŸºæœ¬å­—é«”èˆ‡èƒŒæ™¯ */
html, body {
  margin: 0;
  padding: 0;
  
  font-size: 14px;
  font-weight: 400;
  height: auto;
  overflow-x: hidden;
  overflow-y: auto;
  color: var(--text-primary);
  background: var(--bg-main);
  line-height: 2;
  scroll-behavior: smooth;
  inset: 0px -0.5% -38px 0%;
}

/* æ—¥æ›†ä¸»å®¹å™¨ - è¨­å®šæ—¥æ›†çš„å¤–å±¤å®¹å™¨æ¨£å¼èˆ‡å‹•ç•«æ•ˆæœ */
#calendar-container {
  position: relative;
  width: 100%;
  padding: 0px 0px;
  padding-bottom: 10px;
  max-width: none;
  margin: 0;
  animation: fadeInUp 0.6s ease-out;
}

/* æ—¥æ›†æœ¬é«” - è¨­å®šæ—¥æ›†çš„ä¸»è¦æ¨£å¼ã€èƒŒæ™¯èˆ‡é™°å½± */
#calendar {
  width: 100% !important;
  max-width: none;
  margin: 0;
  height: auto !important;
  background: var(--bg-card);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-medium);
  overflow: visible; /* â­å°‡ hidden æ”¹ç‚º visibleï¼Œè§£é™¤å° sticky çš„é™åˆ¶ */
  border: 2px solid var(--calendar-border);
}

/* æ—¥æ›†æ²å‹•è¨­å®š - é‚„åŸç”± FullCalendar è‡ªè¡Œç®¡ç†é«˜åº¦èˆ‡æ²å‹• */
.fc .fc-scroller { overflow-y: visible !important; height: auto !important; }
.fc-view-harness { height: auto !important; }
#calendar .fc-timegrid-slots table { height: auto !important; }

/* é é¢æ·¡å…¥å‹•ç•« */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ==================== ğŸ“… å·¥å…·åˆ— (Toolbar) ==================== */
:root {
  /* å·¥å…·åˆ—é¡è‰² */
  --calendar-header-bg: linear-gradient(90deg, #4A225D 50%, #6F3381 100%);
  --calendar-header-text: var(--text-light);
}

/* æ—¥æ›†é ‚éƒ¨å·¥å…·åˆ— - åŒ…å«å°èˆªæŒ‰éˆ•å’Œæ¨™é¡Œçš„å€åŸŸ */
#calendar .fc-header-toolbar {
    display: flex;
    align-items: center;
    gap: 5rem;
    background: var(--calendar-header-bg);
    padding: 0px 20px 0px 10px;
    margin-bottom: 0 !important;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    height: 60px;
      
}

/* åªç§»é™¤ã€Œä»Šå¤©ã€æŒ‰éˆ•çš„é è¨­ 13.5px å·¦é‚Šè· */
/* #calendar .fc-header-toolbar .fc-today-button { margin-left: 0 !important; }/* 

/* å·¥å…·åˆ—å€å¡Šä½ˆå±€ - å·¥å…·åˆ—å…§å„å€å¡Šçš„æ’åˆ—æ–¹å¼ */
#calendar .fc-toolbar-chunk {display:var(--border-radius-small);gap: 0.8rem; font-size: 18px;}

/* å·¥å…·åˆ—æ¨™é¡Œæ¨£å¼ - é¡¯ç¤ºç•¶å‰æ—¥æœŸçš„æ¨™é¡Œæ–‡å­— */
#calendar .fc-toolbar-title {
  color: var(--calendar-header-text);
  font-size: 28px;
  letter-spacing: 1px;
}

/* ã€æ—¥æœŸæ¨™é¡Œé–“è·ã€‘å¹´â†”æœˆã€æœˆâ†”æ—¥ çš„å›ºå®šç•™ç™½å¯¬åº¦ */
#calendar .fc-toolbar-title .ym-gap{display:inline-block;width:2em;}
#calendar .fc-toolbar-title .md-gap{display:inline-block;width:2em;}

/* æ—¥æ›†æŒ‰éˆ•æ¨£å¼ - å°èˆªæŒ‰éˆ•çš„åŸºæœ¬æ¨£å¼èˆ‡æ•ˆæœ */
.fc-button {
  background-color: rgba(243, 239, 239, 0.2) !important;  /*æŒ‰éˆ•é¡è‰² */
  border: 1px solid rgba(255, 255, 255, 0.3) !important;  /*æŒ‰éˆ•å¤–æ¡†é¡è‰²*/
  color: var(--text-light) !important;   /* æŒ‰éˆ•æ–‡å­—é¡è‰² */
  height: 38px;
  width: 38px;
  border-radius: var(--border-radius-small) !important;
  padding: 0px !important; /* ä¾‹å¦‚ï¼šä¸Šä¸‹ 6pxï¼Œå·¦å³ 10px */
  font-weight: 400;
  transition: all 0.3s ease;
}

/* æŒ‰éˆ•æ‡¸åœ/ç„¦é»æ•ˆæœ */
.fc-button:hover {background-color: rgba(223, 200, 200, 0.3) !important;transform: translateY(-1px);}
.fc-button:focus { box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3) !important; }

/* ==================== ğŸ“‹ è¡¨é ­ (Header) ==================== */
#calendar .fc-col-header {
    height: 40px;
    background: #592C63;
    border-bottom: 1px solid var(--calendar-border);
    background: linear-gradient(135deg, #66327C 6px, #592C63 6px 12px),
            repeating-linear-gradient(135deg,  #70649A 6px, #b474a2 6px 12px);
  
}
/*text-shadow: 0.71px 0.71px 0 rgba(222, 201, 232, 0.42), 1.41px 1.41px 0 rgba(198, 180, 206, 0.42), 2.12px 2.12px 0 rgba(173, 158, 180, 0.42), 2.83px 2.83px 0 rgba(149, 137, 154, 0.42), 3.54px 3.54px 0 rgba(124, 115, 129, 0.42), 4.24px 4.24px 0 rgba(100, 94, 103, 0.42), 4.95px 4.95px 0 rgba(75, 72, 77, 0.42), 5.66px 5.66px 0 rgba(51, 51, 51, 0.42);*/


/* è¡¨é ­å–®å…ƒæ ¼ */
#calendar .fc-col-header-cell {
  height: 100%;
  padding: 0 !important;
}

/* è¡¨é ­å…§å®¹åŒæ­¥å€ */
#calendar .fc-col-header-cell .fc-scrollgrid-sync-inner {
  height: 100%;
}

/* è¡¨é ­æ–‡å­—æ¨£å¼ - æ˜ŸæœŸå¹¾æ–‡å­—çš„æ¨£å¼è¨­å®š */
#calendar .fc-col-header-cell-cushion {
  display: block;
  text-align: center;
  width: 100%;
  padding: 0 !important;
  line-height: var(--col-header-height, 40px) !important; /* èˆ‡è¡¨é ­åŒæ­¥ */
  gap: 15rem;
  font-family: "Arial Black", Gadget, sans-serif;
  color: #f3f1f2;
  font-size: 27px;
  font-weight: 400;
  letter-spacing: 40px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


/* è¡¨é ­æ²å‹•èˆ‡é‚Šæ¡†è¨­å®š */
#calendar .fc-scrollgrid-section-header .fc-scroller { overflow-y: hidden !important; }
#calendar .fc-scrollgrid { border-top: 1px solid var(--calendar-border); }

/* ==================== â° æ™‚é–“æ¬„ (Time Column) ==================== */
:root {
  /* æ™‚é–“æ¬„é¡è‰² */
  --calendar-content-odd:  #f8f4fc;
  --calendar-content-even: #ffffff;
  --time-major: var(--text-primary); /* 00/30 åˆ† */
  --time-minor: #f8f4fc;   /* 15/45 åˆ† */
}

/* æ™‚é–“æ§½é«˜åº¦èˆ‡èƒŒæ™¯è¨­å®š */
#calendar .fc-timegrid-slot,
#calendar .fc-timegrid-slot.fc-timegrid-slot-label { height: 2.7em !important; }  /* ã€èª¿æ•´ã€‘æ™‚é–“æ ¼é«˜åº¦ */
#calendar .fc-timegrid-slot-lane { background-color: transparent !important; }
#calendar .fc-timegrid-slots tbody tr:nth-child(odd) td.fc-timegrid-slot-lane { background: var(--calendar-content-odd) !important; }   /* åŸºæ•¸ */
#calendar .fc-timegrid-slots tbody tr:nth-child(even) td.fc-timegrid-slot-lane { background: var(--calendar-content-even) !important; }  /* å¶æ•¸ */

/* éç‡Ÿæ¥­å€å¡ŠèƒŒæ™¯ï¼ˆè¦†è“‹æ•´å€‹æ¬„ä½/å…¨å¤©ï¼‰ */
#calendar .fc-non-business { background: transparent !important; }

/* -- è¨­å®šæ™‚é–“æ¬„çš„èƒŒæ™¯é¡è‰² -- */
#calendar .fc-timegrid-slot-label {
  background-color: #f8f4fc !important; /* <-- åœ¨é€™è£¡è¨­å®šæ‚¨æƒ³è¦çš„èƒŒæ™¯è‰² */
  border-color: #c79be0 !important;    /* <-- ä¹Ÿå¯ä»¥é †ä¾¿çµ±ä¸€é‚Šæ¡†é¡è‰² */
}


/* ç”¨é¤æ™‚æ®µï¼š17:30ã€17:45ã€18:00 è®Šè‰²ï¼ˆå«å·¦å´æ™‚é–“æ¨™ç±¤èˆ‡å³å´æ¬„ä½ï¼‰ */
:root { --meal-slot-bg: rgba(230, 231, 178, 0.35); } /* â­æ”¹æˆç´«è‰²åŠé€æ˜ */

/* ç”¨é¤æ™‚æ®µï¼ˆå‘½ä¸­ tdï¼›æé«˜ç‰¹ç•°æ€§ï¼›æ”¾åœ¨å¥‡å¶åˆ—è¦å‰‡ä¹‹å¾Œï¼‰ */
/* å³å´å…§å®¹æ¬„ */
#calendar .fc-timegrid-body td.fc-timegrid-slot.fc-timegrid-slot-lane[data-time="17:30:00"],
#calendar .fc-timegrid-body td.fc-timegrid-slot.fc-timegrid-slot-lane[data-time="17:45:00"],
#calendar .fc-timegrid-body td.fc-timegrid-slot.fc-timegrid-slot-lane[data-time="18:00:00"] {
  background: var(--meal-slot-bg) !important;
}

/* ==================== â° æ™‚é–“æ¨™ç±¤æ¨£å¼ (é‡çµ„ç‰ˆ) ==================== */

#calendar .fc-timegrid-slot-label .fc-timegrid-slot-label-cushion {
    font-size: 16px !important;     /* <-- åœ¨é€™è£¡ä¿®æ”¹æ‚¨æƒ³è¦çš„å¤§å° */
    font-weight: 400 !important;   /* <-- åœ¨é€™è£¡ä¿®æ”¹æ‚¨æƒ³è¦çš„å­—é‡ */
    color: #A08DAA !important;      /* <-- åœ¨é€™è£¡ä¿®æ”¹æ‚¨æƒ³è¦çš„é¡è‰² */
}

/* --- 2. è¨­å®šã€ä¸»è¦æ™‚é–“æ¨™ç±¤ã€‘(00/30 åˆ†) çš„æ¨£å¼ --- */
/*    é€™å€‹é¸æ“‡å™¨æ›´å…·é«”ï¼Œæ‰€ä»¥æœƒè¦†è“‹é€šç”¨è¦å‰‡ */
#calendar .fc-timegrid-slot-label.slot-major-0030 .fc-timegrid-slot-label-cushion {
    font-size: 18px !important;
    font-weight: 600 !important;
    color: #783f83bd !important;
}

/* ==================== ğŸ« äº‹ä»¶å¡ç‰‡ (Event Card) ==================== */
:root {
  /* äº‹ä»¶é è¨­è‰² */
  --event-default-bg: var(--kikyo-primary);
  --event-default-text: var(--text-light);

  /* è¨­è¨ˆå¸«é¡è‰² */
  --stylist-1-bg: #005CAF;
  --stylist-1-text: #f8f1f1;
  --stylist-1-bg-light: #5995e1;
  --stylist-2-bg: #E03C8A;
  --stylist-2-text: #f8f1f1;
  --stylist-2-bg-light: #f082a1;
  --stylist-3-bg: #42602D;
  --stylist-3-text: #f8f1f1;
  --stylist-3-bg-light: #7BA23F;
}

/* --- B. äº‹ä»¶å¡ç‰‡çš„æ–‡å­—èˆ‡å…§å®¹æ’ç‰ˆ (åˆä½µç‰ˆ) --- */

/* å°‡å…©å€‹é¸æ“‡å™¨ç”¨é€—è™Ÿéš”é–‹ï¼Œå…±ç”¨ç›¸åŒçš„æ¨£å¼ */
#calendar .fc-timegrid-event .fc-event-title,
#calendar .fc-event.blocked-time .fc-event-title {
  /* --- ä»¥ä¸‹æ˜¯å®ƒå€‘å…±ç”¨çš„æ¨£å¼ --- */
  display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    padding: 0 0px;
    font-weight: 400;
    line-height: 1.3;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    letter-spacing: 0px;
}

/* æ¡Œé¢ç‰ˆï¼šè®“äº‹ä»¶å¡ç‰‡å·¦å³ç•™ç™½ï¼Œä¸å æ»¿æ ¼å­ */
@media (min-width: 1025px) {
      #calendar .fc-timegrid-event:not(.fc-bg-event) {right: -3px; /* å³å´å¤šå‡º 3px ç©ºé–“ */
       }}

#calendar .fc-resourceTimeGridWeek-view .fc-timegrid-event { 
  right: -3 px;
    border-radius: 0 !important;
  }      

/* è®“äº‹ä»¶å¡ç‰‡å³é‚Šå¤šä¸€äº›è·é›¢ inset å€¼ */
#calendar .fc-timegrid-event-harness { right: 5% !important; } 
/* é‡å°ã€ä¸€èˆ¬é ç´„ã€‘å¡ç‰‡çš„æ–‡å­—å¤§å° */
#calendar .fc-timegrid-event .fc-event-title {
  font-size: 20px; /* ä¸€èˆ¬é ç´„çš„æ–‡å­—å¤§å° */
}

/* é‡å°ã€ä¸ç´„æ™‚æ®µã€‘å¡ç‰‡çš„åœ–ç¤ºå¤§å° */
#calendar .fc-event.blocked-time .fc-event-title {
  font-size: 24px; /* ä¸ç´„æ™‚æ®µçš„åœ–ç¤ºå¤§å°ï¼Œå¯ä»¥è¨­å¤§ä¸€é» */
}

/* äº‹ä»¶å¡ç‰‡æ‡¸åœæ•ˆæœ */
#calendar .fc-timegrid-event:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-medium);
}

/* æœå‹™å¾½ç« æ¨£å¼ */
.svc-badge{
  font-size: 22px; font-weight: 700; margin-right: 6px; line-height: 1;
}

/* äº‹ä»¶å¤šæ®µæ–‡å­—ä½ˆå±€ */
.fc-timegrid-event .fc-event-title.evt-line{
  display:flex; justify-content:center; align-items:center;
  gap:20px;    /* ã€èª¿æ•´ã€‘æ¯æ®µå­—ï¼ˆæœå‹™ã€æ™‚é–“ã€å§“åç­‰ï¼‰çš„é–“è· */
}
.evt-svc{ font-size:24px; font-weight:700; gap:10px; }
.evt-time{ min-width:48px; text-align:right; }
.evt-phone{ letter-spacing:1px; }



/* --- C. è¨­è¨ˆå¸«é¡è‰²å¥—ç”¨è¦å‰‡ --- */
#calendar .fc-event.sty-1{ background: var(--stylist-1-bg) !important; border-color: var(--stylist-1-bg) !important; color: var(--stylist-1-text) !important; }
#calendar .fc-event.sty-2{ background: var(--stylist-2-bg) !important; border-color: var(--stylist-2-bg) !important; color: var(--stylist-2-text) !important; }
#calendar .fc-event.sty-3{ background: var(--stylist-3-bg) !important; border-color: var(--stylist-3-bg) !important; color: var(--stylist-3-text) !important; }

#calendar .fc-event.sty-1.blocked-time{ background: var(--stylist-1-bg-light) !important; border-color: var(--stylist-1-bg-light) !important; color: var(--stylist-1-text) !important; }
#calendar .fc-event.sty-2.blocked-time{ background: var(--stylist-2-bg-light) !important; border-color: var(--stylist-2-bg-light) !important; color: var(--stylist-2-text) !important; }
#calendar .fc-event.sty-3.blocked-time{ background: var(--stylist-3-bg-light) !important; border-color: var(--stylist-3-bg-light) !important; color: var(--stylist-3-text) !important; }



/* ==================== ğŸ’¬ ç•™è¨€å€ (Notes) ==================== */
:root {
  /* ç•™è¨€å€é¡è‰² */
  --notes-bg:     var(--bg-card);
  --notes-border: var(--calendar-border);
  --notes-shadow: 0 4px 12px rgba(93,78,117,0.1);
}

/* ç•™è¨€å€å¤–å®¹å™¨ */
#notes-section {width: 100%; max-width: none; margin: 10px 0; padding: 0 15px; animation: fadeInUp 0.8s ease-out;}

/* ç•™è¨€å¡ç‰‡å®¹å™¨ */
.notes-container {background: var(--notes-bg); border: 2px solid var(--notes-border); border-radius: var(--border-radius); padding: 25px; box-shadow: var(--notes-shadow); transition: all 0.3s ease;}
.notes-container:hover {box-shadow: var(--shadow-medium); transform: translateY(-2px);}

/* ç•™è¨€æ¿æ¨™é¡Œåˆ— */
.notes-header {display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--calendar-border);}
.notes-header h4 {margin: 0; color: var(--kikyo-primary); font-size: 20px; font-weight: 500; display: flex; align-items: center; gap: 10px;}
.notes-header h4::before {content: "ğŸ’­"; font-size: 24px;}

/* è‡ªå‹•å„²å­˜æç¤º */
.notes-meta {margin-left: auto; color: var(--text-muted); font-size: 12px; display: flex; align-items: center; gap: 5px;}
.notes-meta::before {content: "ğŸ’¾"; font-size: 14px;}

/* ç­†è¨˜è¼¸å…¥æ¡† */
#notes-content {width: 100%; min-height: 200px; padding: 20px; box-sizing: border-box; border: 2px solid var(--calendar-border); border-radius: var(--border-radius-small); font-size: 14px; line-height: 1.6; font-family: inherit; background: var(--bg-card); color: var(--text-primary); resize: vertical; transition: all 0.3s ease;}
#notes-content:focus {outline: none; border-color: var(--kikyo-primary); box-shadow: 0 0 0 3px rgba(93, 78, 117, 0.1);}

#notes-content {
    font-size: 22px;
    color: #110677;
font-weight: 500;letter-spacing: 1px;
} 
/* ==================== ğŸ“± æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ (Mobile) ==================== */
@media (max-width: 1024px) {
    /* å…¨å±€èª¿æ•´ */
    #calendar-container { padding: 3px; }
    #calendar { width: 100vw !important; margin: 0 -10px; border-radius: 0; }

    /* å·¥å…·åˆ—èª¿æ•´ */
     #calendar .fc-header-toolbar {
    padding: 8px 16px;
    height:42px;
  }
     #calendar .fc-toolbar-title {
    white-space: nowrap;
    font-size: clamp(16px, 6vw, 24px);     /* ä¾è¢å¹•è‡ªå‹•ç¸®æ”¾ */
    letter-spacing: clamp(0px, 0.3vw, 1px); /* é˜²æ­¢å­—è·éå¯¬ */
    min-width: 0;                           /* å…è¨±ç¸®å°ä»¥é¿å…è¢«æ“ å‡º */
  }
    /* è¡¨é ­èª¿æ•´ */
    :root{
      --col-header-height: 30px;
      --col-header-size:   16px;
    }

   /* ç›´æ¥è¦†å¯«æ¡Œé¢ 40pxï¼Œé–å®šç‚º 30px */
#calendar .fc-col-header { height: var(--col-header-height) !important; } 
   #calendar .fc-col-header-cell-cushion{
  text-shadow: 0 1px 0 #fff, 0 1px 4px rgba(0,0,0,.18);
  font-size: 22px;              /* æ‰‹æ©Ÿå›ºå®šå€¼ï¼Œå¯å†èª¿ */
  letter-spacing: 4px;         /* æ‰‹æ©Ÿå›ºå®šå€¼ï¼Œå¯å†èª¿ */
  line-height: var(--col-header-height); /* æ‰‹æ©Ÿç”¨ 30px è®Šæ•¸ */
}

#calendar .evt-phone {
  display: none !important;
}

    /* äº‹ä»¶å¡ç‰‡èª¿æ•´ */
    #calendar .fc-timegrid-event { height: 100% !important; }
    #calendar .fc-timegrid-event .fc-event-title { font-size: 16px; line-height: 1.2; padding: 0 6px; }
    .svc-badge{ font-size: 12px; }
    .fc-timegrid-event .fc-event-title.evt-line{ gap:3px; }
    .evt-svc{ font-size:18px; }
    
#calendar .fc-timegrid-event-harness {
  width: calc(100% - 10px) !important; /* ç¸½å¯¬åº¦æ¸›å°‘10px */
  left: 5px !important;                /* å¾å·¦é‚Šæ¨ç§»5pxä¾†ç½®ä¸­ */
}


}
    
    /* å½ˆçª—èª¿æ•´ */
    .modal-content { width: 95%; margin: 2% auto; padding: 20px; }
/* ==================== ğŸªŸ å½ˆçª—æ¨£å¼ (Modal) - æœªåŒ…å«åœ¨æ’åºå…§ï¼Œç½®æ–¼æ­¤è™• ==================== */
:root {
  /* æŒ‰éˆ•é¡è‰² */
  --button-primary-bg:   var(--kikyo-primary);
  --button-primary-text: var(--text-light);
  --button-secondary-bg: var(--bg-card);
  --button-secondary-text: var(--text-primary);
  --button-border: var(--calendar-border);
}

/* å½ˆçª—èƒŒæ™¯é®ç½© */
.modal { display: none; position: fixed; z-index: 1000; inset: 0; overflow: auto; background: var(--modal-overlay); backdrop-filter: blur(4px); }

/* å½ˆçª—å…§å®¹å®¹å™¨ */
.modal-content { background: var(--modal-bg); margin: 5% auto; padding: 30px; border: 1px solid var(--modal-border); width: 90%; max-width: 500px; border-radius: var(--border-radius); max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-medium); transform: translateY(-20px); animation: modalSlideIn 0.3s ease-out forwards; }
@keyframes modalSlideIn { to { transform: translateY(0); } }

/* å½ˆçª—é—œé–‰æŒ‰éˆ• */
.close-button { color: var(--text-muted); float: right; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s ease; line-height: 1; }
.close-button:hover, .close-button:focus { color: var(--kikyo-primary); transform: scale(1.1); }

/* å½ˆçª—è¡¨å–®æ¨£å¼ */
#appointmentForm h3 { color: var(--kikyo-primary); font-weight: 500; margin-bottom: 20px; font-size: 20px; }
#appointmentForm label { margin-top: 15px; display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 5px; }
#appointmentForm input, #appointmentForm select, #appointmentForm textarea { width: 100%; padding: 12px; margin-top: 4px; border: 2px solid var(--calendar-border); border-radius: var(--border-radius-small); box-sizing: border-box; font-family: inherit; font-size: 14px; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
#appointmentForm input:focus, #appointmentForm select:focus, #appointmentForm textarea:focus { outline: none; border-color: var(--kikyo-primary); box-shadow: 0 0 0 3px rgba(93, 78, 117, 0.1); }

/* é ç´„é¡å‹é¸æ“‡å€å¡Š */
.appointment-type-section { margin: 20px 0; padding: 15px; border: 2px solid var(--calendar-border); border-radius: var(--border-radius-small); background: var(--bg-active); }
.appointment-type-section label { margin-top: 0 !important; margin-bottom: 10px; font-weight: 500; color: var(--kikyo-primary); }
.radio-group { display: flex; gap: 20px; margin-top: 8px; }
.radio-group input[type="radio"] { width: auto !important; margin-right: 8px; accent-color: var(--kikyo-primary); }
.radio-group label { margin-top: 0 !important; font-weight: normal !important; display: flex; align-items: center; color: var(--text-primary); cursor: pointer; transition: color 0.3s ease; }
.radio-group label:hover { color: var(--kikyo-primary); }

/* è¡¨å–®æŒ‰éˆ• */
#submit-btn, #deleteBtn { color: var(--button-primary-text); border: none; padding: 12px 24px; border-radius: var(--border-radius-small); cursor: pointer; font-weight: 500; font-size: 16px; transition: all 0.3s ease; box-shadow: var(--shadow-soft); }
#submit-btn { background: linear-gradient(135deg, var(--kikyo-primary) 0%, var(--kikyo-light) 100%); }
#deleteBtn { background: #C0392B; }
#submit-btn:hover, #deleteBtn:hover { transform: translateY(-2px); box-shadow: var(--shadow-medium); }
#deleteBtn:hover { background: #E74C3C; }
#submit-btn:active, #deleteBtn:active { transform: translateY(0); }

/* ==================== ğŸ”— æ—¥æ›†æ ¼ç·šèˆ‡åˆ†éš”ç·š (æœ€çµ‚æ•´åˆç‰ˆ) ==================== */

:root {
  /* --- åœ¨é€™è£¡çµ±ä¸€ç®¡ç†æ‰€æœ‰ç·šæ¢çš„é¡è‰²èˆ‡ç²—ç´° --- */
  --calendar-line-color: #e0bbf3; /* çµ±ä¸€ç·šæ¢é¡è‰² */
  --calendar-line-width: 1px;      /* çµ±ä¸€ç·šæ¢ç²—ç´° */
}
/* --- æ–°å¢é€™æ®µä¾†ç§»é™¤äº‹ä»¶å®¹å™¨çš„å·¦å³å¤–é‚Šè· --- */
#calendar .fc-timegrid-col-events {
  margin-left: 0 !important;
  margin-right: 0 !important;
}

/* a) ç‚ºã€å·¦å´æ™‚é–“æ¬„ã€‘çš„å³é‚Šï¼Œç•«ä¸€æ¢å‚ç›´ç·š */
#calendar .fc-timegrid-slot-label {
  border-right: var(--calendar-line-width) solid var(--calendar-line-color) !important;
}

/* b) ç‚ºã€å…§å®¹å€çš„æ¯ä¸€æ¬„ã€‘çš„å³é‚Šï¼Œç•«ä¸€æ¢å‚ç›´ç·š (ä½¿ç”¨å½å…ƒç´ ï¼Œä½ˆå±€æœ€å®‰å…¨) */
#calendar .fc-timegrid-body .fc-timegrid-col { 
  position: relative; 
}
#calendar .fc-timegrid-body .fc-timegrid-col:not(:last-child)::after {
  content: ""; /* ç¢ºä¿å½å…ƒç´ èƒ½è¢«ç”Ÿæˆ */
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  width: var(--calendar-line-width);   /* ä½¿ç”¨è®Šæ•¸æ§åˆ¶ç²—ç´° */
  background: var(--calendar-line-color); /* ä½¿ç”¨è®Šæ•¸æ§åˆ¶é¡è‰² */
  z-index: 4; /* ç¢ºä¿ç·šæ¢é¡¯ç¤ºåœ¨èƒŒæ™¯ä¹‹ä¸Š */
  pointer-events: none;
}

/* a) ç‚ºã€æ‰€æœ‰æ™‚é–“æ ¼ã€‘(åŒ…æ‹¬å·¦å´æ™‚é–“æ¬„å’Œå³å´å…§å®¹å€) çš„åº•éƒ¨ï¼Œç•«ä¸€æ¢æ°´å¹³ç·š */
#calendar .fc-timegrid-slot {
  border-bottom: var(--calendar-line-width) solid var(--calendar-line-color) !important;
}

/* b) ã€å¯é¸å„ªåŒ–ã€‘ç§»é™¤è¡¨æ ¼æœ€åº•éƒ¨çš„é‡è¤‡ç·šæ¢ï¼Œè®“å¤–è§€æ›´ä¹¾æ·¨ */
#calendar .fc-timegrid-slots table {
  border-bottom: none !important;
}

/* é€±ä¸€å…¬ä¼‘è¦†è“‹å±¤ */
#calendar .closed-overlay{
  position:absolute;           /* çµ•å°å®šä½ï¼Œé–åœ¨çˆ¶å±¤æ¬„ä½å…§ */
  inset:0;                     /* ä¸Šå³ä¸‹å·¦çš†ç‚º 0ï¼Œæ•´æ¬„å…¨è¦†è“‹ï¼›æƒ³åªè“‹ä¸ŠåŠï¼šinset:0 0 50% 0 */
  background:rgba(89,44,99,.35);/* èƒŒæ™¯è‰²èˆ‡é€æ˜åº¦ï¼›æœ€å¾Œçš„ .45 è¶Šå°è¶Šé€æ˜ */
  display:flex;                /* ç”¨ flex è®“æ–‡å­—ç½®ä¸­ */
  align-items:center;          /* å‚ç›´ç½®ä¸­ */
  padding-bottom: 500px;       /* â­æ–°å¢ï¼šå¢åŠ åº•éƒ¨å…§è·å°‡æ–‡å­—ä¸Šæ¨ã€‚æ•¸å€¼è¶Šå¤§ï¼Œæ–‡å­—è¶Šé ä¸Š */
  justify-content:center;      /* æ°´å¹³ç½®ä¸­ */
  color:#fff;                  /* æ–‡å­—é¡è‰² */
  font-weight:700;             /* ç²—é«” */
  font-size:clamp(36px,12vw,96px);/* è‡ªé©æ‡‰å­—ç´šï¼›è¦å›ºå®šå¤§å°å¯æ”¹æˆ 64px ç­‰å›ºå®šå€¼ */
  letter-spacing:.2em;         /* å­—è·ï¼›æ•¸å€¼è¶Šå¤§è¶Šç– */
  text-shadow:0 2px 6px rgba(0,0,0,.3);/* æ–‡å­—é™°å½±ï¼Œæå‡å°æ¯” */
  z-index:20;                   /* ç–Šå±¤é †åºï¼›è‹¥è¢«å…¶ä»–å…ƒç´ è“‹æ‰å°±èª¿å¤§ï¼Œå¦‚ 20 æˆ– 100 */
  pointer-events:none;         /* ä¸æ“‹æ»‘é¼ æ“ä½œï¼›è‹¥è¦é–ä½åº•ä¸‹æ“ä½œæ”¹æˆ auto */
  text-align:center; /* â­æ–°å¢ï¼šæ–‡å­—æ°´å¹³ç½®ä¸­ */
}
/* è®“æ™‚é–“æ¬„èƒ½æ”¾çµ•å°å®šä½è¦†è“‹å±¤ */
#calendar .fc-timegrid-axis{ position:relative; }

/* æ™‚é–“æ¬„çš„è¦†è“‹å±¤ä¸éœ€è¦æ–‡å­— */
#calendar .closed-overlay.axis-overlay{ font-size:0; }

/* ã€â­æ–°å¢è¦å‰‡ã€‘ç•¶æ—¥æ›†ç‚ºå…¬ä¼‘æ—¥(is-closed-day)æ™‚ï¼Œæ”¹è®Šæ™‚é–“æ¬„çš„èƒŒæ™¯è‰² */
#calendar.is-closed-day .fc-timegrid-slot-label {
  background-color: rgba(89, 44, 99, .35) !important;
}

/* æ’ä¼‘æŒ‰éˆ•åœ–ç¤º */
.leave-icon-button{
  display:inline-block;
  width:32px; height:32px;
  vertical-align:middle;
  background: url("hlld.png") no-repeat center/contain; /* èˆ‡ index.html åŒè³‡æ–™å¤¾ */
  border-radius:4px;
  cursor:pointer;
  padding:0;               /* æ¸…æ‰åŸå…ˆå…§è· */
}
.leave-icon-button:hover {background-color: rgba(255, 255, 255, 0.2);}
/* ç´„æ»¿æŒ‰éˆ•æ¨£å¼ */
.fully-booked-button{
  display:inline-block;
  width:42px; height:42px;
  padding:0 30px;
  vertical-align:middle;   /* é¿å… baseline ç©ºéš™ */
  background: rgba(89,44,99,0.2) url("icon_pause_white_42h.png?v=1") no-repeat center/contain;
  color:transparent; 
}
.fully-booked-button.fb-active{
  background:#ff4d4f url("icon_pause_white_42h.png?v=1") no-repeat center/contain;
}

/* ç´„æ»¿æ¬„ä½å¤–æ¡† */
.fc-timegrid-col.fully-booked-col{
  outline: 4px solid #ff4d4f; outline-offset: -2px;
  box-shadow: inset 0 0 0 2px rgba(255,77,79,.45);
}

/* ç´„æ»¿å¤–æ¡†ï¼ˆä¸æ“‹é»æ“Šï¼‰ */
#calendar .fully-booked-outline{
  position:absolute; inset:0;
  border:4px solid #ff4d4f;
  box-shadow: inset 0 0 0 2px rgba(255,77,79,.4);
  pointer-events:none;
  z-index:50;           /* è“‹éæ ¼ç·šèˆ‡äº‹ä»¶ */
  border-radius:2px;
}


/* === æœˆè¦–åœ–ï¼šå›ºå®šä¼‘å‡åº•è‰²èˆ‡æ¨™ç±¤æ–‡å­— === */
#calendar { touch-action: manipulation; } /* åƒ…å„ªåŒ–é»æ“Šï¼Œèˆ‡æœˆè¦–åœ–ç„¡è¡çª */

/* å¤šæœˆè¦–åœ–ï¼šæ¯å€‹ã€Œæœˆä»½ã€ä¹‹é–“ç•™ç™½ï¼ˆåƒ…ä½œç”¨æ–¼ multiMonth æœˆè¦–åœ–ï¼‰ */
.fc-multiMonthMonth-view .fc-multimonth-month { 
  padding: 8px;
}
/* é€±ä¸€å…¬ä¼‘ï¼šåº•è‰² + å³ä¸‹è§’ã€Œå…¬ä¼‘ã€ */
.fc-dayGridMonth-view .closed-day-bg { 
  background-color: #e0e0e0 !important; 
  color: #333; 
  position: relative;
}
.fc-dayGridMonth-view .closed-day-bg::after {
  content: 'å…¬ä¼‘';
  position: absolute;
  right: 6px; bottom: 4px;
  padding: 2px 6px;
  font-size: 12px;
  border-radius: 4px;
  background: rgba(0,0,0,0.12);
}

/* é€±å››åº—é•·ä¼‘ï¼šåº•è‰² + å³ä¸‹è§’ã€Œåº—é•·ä¼‘ã€ */
.fc-dayGridMonth-view .leave-boss { 
  background-color: #e0f0ff !important; 
  position: relative;
}
.fc-dayGridMonth-view .leave-boss::after {
  content: 'åº—é•·ä¼‘';
  position: absolute;
  right: 6px; bottom: 4px;
  padding: 2px 6px;
  font-size: 12px;
  border-radius: 4px;
  background: rgba(0,0,0,0.08);
}

/* é€±æ—¥é›…å©·ä¼‘ï¼šåƒ…åº•è‰² */
.fc-dayGridMonth-view .leave-yatting { 
  background-color: #ffe0e0 !important; 
}

/* é€±äºŒå°ç™½ä¼‘ï¼šåƒ…åº•è‰² */
.fc-dayGridMonth-view .leave-xiaobai { 
  background-color: #e0f8ff !important; 
}

/* å¼·åˆ¶ä¿éšªï¼šæœˆè¦–åœ–éš±è—æ‰€æœ‰äº‹ä»¶å…ƒç´  */
.fc-dayGridMonth-view .fc-event,
.fc-dayGridMonth-view .fc-daygrid-event,
.fc-dayGridMonth-view .fc-daygrid-dot-event,
.fc-dayGridMonth-view .fc-daygrid-block-event {
  display: none !important;
}

/* æœˆè¦–åœ–æ¨™é¡Œé…è‰² */
#calendar .fc-toolbar-title.is-month-title .title-month-text{
  color: #FFD166;              /* æœˆä»½æ–‡å­—é¡è‰² */
}

/* åªèª¿æ•´é€±è¦–åœ–æ—¥æœŸå­—æ¨£å¤§å°èˆ‡å­—è· */
#calendar .fc-resourceTimeGridWeek-view .fc-col-header-cell-cushion{
      font-size: 16px;
    letter-spacing: 1px;
    font-family: 'fcicons';
}

/* åƒ…åœ¨é€±è¦–åœ– (resourceTimeGridWeek) ä¸­ï¼Œéš±è—æ‰€æœ‰çš„äº‹ä»¶å¡ç‰‡å…ƒç´  */
.fc-resourceTimeGridWeek-view .fc-event-title  {
  display: none !important;
} 


</style>

</head>
<body>
    <!-- æ—¥æ›†ä¸»å®¹å™¨ -->
    <div id="calendar-container">
        <div id="calendar"></div>

        <!-- é ç´„å½ˆçª— -->
        <div id="appointmentModal" class="modal">
          <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>âœ¨ æ–°å¢/ç·¨è¼¯é ç´„</h3>
            <form id="appointmentForm">
              <input type="hidden" id="event_id" name="event_id">
              <input type="hidden" id="start_time" name="start_time">
              
              <input type="hidden" id="employee_id" name="employee_id">

              <label for="minute_select">ğŸ• é–‹å§‹åˆ†é˜</label>
              <select id="minute_select" name="minute_select"></select>

              <div class="appointment-type-section">
                <label>ğŸ“‹ é ç´„é¡å‹</label>
                <div class="radio-group">
                  <label>
                    <input type="radio" name="appointment_type" value="normal" checked>
                    âœ… ä¸€èˆ¬é ç´„
                  </label>
                  <label>
                    <input type="radio" name="appointment_type" value="blocked">
                    ğŸš« ä¸ç´„æ™‚æ®µ
                  </label>
                </div>
              </div>
      

              <div id="customer-fields">
                <label for="customer_phone">ğŸ“ é¡§å®¢é›»è©±</label>
                <input type="tel" id="customer_phone" name="customer_phone"
                      inputmode="numeric" autocomplete="off" placeholder="09xx-xxx-xxx">


                <label for="customer_name">ğŸ‘¤ é¡§å®¢å§“å</label>
                <input type="text" id="customer_name" name="customer_name" placeholder="è«‹è¼¸å…¥é¡§å®¢å§“å">

                <label for="service_id">ğŸ’‡ æœå‹™é …ç›® (å¯é¸)</label>
                <select id="service_id" name="service_id">
                  <option value="">-- è«‹é¸æ“‡æœå‹™ (å¯ä¸é¸) --</option>
                  <option value="å‰ªé«®">âœ‚ï¸ å‰ªé«®</option>
                  <option value="å‰ª+æŸ“">âœ‚ï¸ğŸ¨ å‰ª+æŸ“</option>
                  <option value="å‰ª+ç‡™">âœ‚ï¸ğŸŒ€ å‰ª+ç‡™</option>
                  <option value="å‰ª+æŸ“+ç‡™">âœ‚ï¸ğŸ¨ğŸŒ€ å‰ª+æŸ“+ç‡™</option>
                  <option value="å‰ª+é ­çš®è­·ç†">âœ‚ï¸ğŸ’† å‰ª+é ­çš®è­·ç†</option>
                </select>
              </div>

              <label for="notes">ğŸ“ å‚™è¨»</label>
              <textarea id="notes" name="notes" rows="3" placeholder="è«‹è¼¸å…¥å‚™è¨»è³‡è¨Š..."></textarea>

              <div style="margin-top: 20px; text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
                <button type="button" id="deleteBtn" style="display:none;">ğŸ—‘ï¸ åˆªé™¤é ç´„</button>
                <button type="submit" id="submit-btn">ğŸ’¾ å„²å­˜é ç´„</button>
              </div>
            </form>
          </div>
        </div>
          <div id="leaveModal" class="modal">
  <div class="modal-content">
    <span class="close-button leave-close-button">&times;</span>
    <h3 id="leaveModalTitle">ğŸ“… è¨­å®šæ’ä¼‘</h3>
    <p>æ‚¨æ­£åœ¨ç‚º <b id="leaveModalResourceName"></b> è¨­å®š <b id="leaveModalDate"></b> çš„æ’ä¼‘ç‹€æ…‹ã€‚</p>
    <form id="leaveForm">
      <input type="hidden" id="leaveResourceId">
      <input type="hidden" id="leaveDate">
      <label for="leaveReason">æ’ä¼‘åŸå›  (æœƒé¡¯ç¤ºåœ¨æ ¼å­ä¸Š)</label>
      <input type="text" id="leaveReason" name="leaveReason" placeholder="ä¾‹å¦‚ï¼šåº—ä¼‘ã€ç‰¹ä¼‘ã€é€²ä¿®">
      <div style="margin-top: 20px; text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
        <button type="button" id="deleteLeaveBtn" style="background: #C0392B;">ğŸ—‘ï¸ å–æ¶ˆæ’ä¼‘</button>
        <button type="submit" id="submitLeaveBtn">ğŸ’¾ å„²å­˜è¨­å®š</button>
      </div>
    </form>
  </div>
</div>  

    <!-- ç•™è¨€å€ -->
    <div id="notes-section">
        <div class="notes-container">
            <div class="notes-header">
  <h4>ç•™è¨€æ¿</h4>
  <div class="notes-meta"><span>æœªå„²å­˜</span></div>
  <button id="save-notes-btn" type="button">ğŸ’¾ å„²å­˜ä»Šæ—¥ç•™è¨€</button>
</div>
<textarea id="notes-content" placeholder="è«‹è¼¸å…¥ä»Šæ—¥ç•™è¨€..."></textarea>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@5.11.5/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/locales/zh-tw.js"></script>

<script>

// å¾Œç«¯ Google Apps Script ç¶²å€
const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzoORmKDxoasxiK9qcjaofSnt34qL9OxED4Qd-hRLAGzH4assOXmyF_Ab_tBz13-v3NdA/exec';

(function(){
  // ==================== å…¨åŸŸè®Šæ•¸ ====================
  let employeeLeaveData = []; // ç”¨ä¾†å­˜æ”¾å¾å¾Œç«¯å–å›çš„æ’ä¼‘è³‡æ–™
  const ymd = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; 
let currentYmd = null;
  let calendar; // å°‡ calendar å®£å‘Šåœ¨å¤–é¢ï¼Œæ–¹ä¾¿å„å‡½å¼ä½¿ç”¨

  // ==================== DOMContentLoaded Event Listener ====================
  document.addEventListener('DOMContentLoaded', function(){
    // --- å…ƒç´ é¸æ“‡ (å®Œæ•´ç‰ˆ) ---
    const calendarEl = document.getElementById('calendar');
    const appointmentModal = document.getElementById('appointmentModal');
    const leaveModal = document.getElementById('leaveModal');
    const form = document.getElementById('appointmentForm');
    const leaveForm = document.getElementById('leaveForm');
    const notesTextarea = document.getElementById('notes-content');
    const phoneEl = document.getElementById('customer_phone');
    const customerFields = document.getElementById('customer-fields');
    const submitBtn = document.getElementById('submit-btn');
    const deleteBtn = document.getElementById('deleteBtn');
    const eventIdInput = document.getElementById('event_id');
    const appointmentCloseButton = appointmentModal.querySelector('.close-button');
    const leaveCloseButton = leaveModal.querySelector('.leave-close-button');
    const deleteLeaveBtn = document.getElementById('deleteLeaveBtn');

    // --- ç¨‹å¼ä¸€é–‹å§‹åŸ·è¡Œçš„ä¸‰å€‹ä¸»è¦å‹•ä½œ ---
    initializeCalendar();
    fetchAllCloudData();
    bindEventListeners();
    
    // ========================================================
    // ä»¥ä¸‹å…¨éƒ¨æ˜¯å‡½å¼çš„è©³ç´°å®šç¾©
    // ========================================================
    async function fetchDailyNote(dStr){
      const meta = document.querySelector('.notes-meta span');
      const notesTextarea = document.getElementById('notes-content'); // ç¢ºä¿æŠ“åˆ°æœ€æ–°çš„å…ƒç´ 

      // 1. ç«‹å³æ¸…ç©ºç•™è¨€å€ä¸¦é¡¯ç¤ºè¼‰å…¥ä¸­ï¼Œé¿å…èˆŠè³‡æ–™æ®˜ç•™
      notesTextarea.value = '';
      notesTextarea.placeholder = 'ç•™è¨€è¼‰å…¥ä¸­...';
      meta.textContent = 'è¼‰å…¥ä¸­...';

      try{
        const r = await fetch(APPS_SCRIPT_WEB_APP_URL + '?action=getNotes&date=' + encodeURIComponent(dStr));
        const j = await r.json();

        // 2. è¼‰å…¥æˆåŠŸå¾Œï¼Œå¡«å…¥æ–°è³‡æ–™
        notesTextarea.value = j.content || '';
        meta.textContent = 'å·²è¼‰å…¥';
      } catch(e) {
        // 3. è¼‰å…¥å¤±æ•—çš„è™•ç†
        meta.textContent = 'è¼‰å…¥å¤±æ•—';
        console.error("è®€å–ç•™è¨€å¤±æ•—:", e); // åœ¨ä¸»æ§å°é¡¯ç¤ºè©³ç´°éŒ¯èª¤ï¼Œæ–¹ä¾¿é™¤éŒ¯
      } finally {
        // 4. ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½æ¢å¾©é è¨­æç¤ºæ–‡å­—
        notesTextarea.placeholder = 'è«‹è¼¸å…¥å‚™è¨»è³‡è¨Š...';
      }
    }

    function initializeCalendar() {
  // ğŸ‘‡ v6 çš„æ’ä»¶æ˜¯æ›è¼‰åœ¨ FullCalendar.globalPlugins ä¸Šçš„
  const { resourceTimeGridPlugin, dayGridPlugin, interactionPlugin } = FullCalendar.globalPlugins;

  calendar = new FullCalendar.Calendar(calendarEl, {
        schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
        locale: 'zh-tw',
        timeZone: 'Asia/Taipei',
initialView: 'resourceTimeGridDay',

// é€™æ˜¯å…¨åŸŸçš„å·¥å…·åˆ—è¨­å®šï¼Œå°æ‰€æœ‰è¦–åœ–éƒ½æœ‰æ•ˆ
headerToolbar: {
  left: 'prev,next today',
  center: 'title',
  right: 'resourceTimeGridDay,resourceTimeGridWeek,dayGridMonth' // åŠ å…¥æœˆè¦–åœ–
},

firstDay: 2,       // å…¨åŸŸè¨­å®šï¼Œå¾é€±äºŒé–‹å§‹
hiddenDays: [1],   // å…¨åŸŸè¨­å®šï¼Œéš±è—é€±ä¸€

        buttonText: { 
  today: 'ä»Š',
  dayGridMonth: 'æœˆ',
  resourceTimeGridDay: 'æ—¥',
  resourceTimeGridWeek: 'é€±'
},

        allDaySlot: false,
        slotMinTime: '12:00:00',
        slotMaxTime: '21:00:00',
        slotDuration: '00:15:00',
        slotLabelInterval: '00:15:00',
        slotLabelFormat: { hour: '2-digit', minute: '2-digit', hour12: false },
         dayHeaderContent: function(arg) {
          const date = arg.date;
          const month = date.getMonth() + 1;
          const day = date.getDate();
          const weekdayMap = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
          const weekday = weekdayMap[date.getDay()];

           return weekday;

        },
        displayEventTime: false,
        height: 'auto',
        expandRows: false,
        handleWindowResize: true,
        businessHours: [ { daysOfWeek: [0,2,3,4,5,6], startTime: '00:00', endTime: '24:00' } ],
        resources: [ { id: '1', title: 'åº—é•·' }, { id: '2', title: 'é›…å©·' }, { id: '3', title: 'å°ç™½' } ],
        
        events: APPS_SCRIPT_WEB_APP_URL + '?action=getEvents',

// æœˆè¦–åœ–ä¸é¡¯ç¤ºäº‹ä»¶å¡ç‰‡
views: {
  // é€±è¦–åœ–çš„è¨­å®šä¿æŒä¸è®Š
  resourceTimeGridWeek: {
    hiddenDays: [1]
    // æ³¨æ„ï¼šæˆ‘å€‘æŠŠ headerToolbar çš„è¨­å®šç§»åˆ°å¤–é¢ï¼Œé€™è£¡ä¿æŒä¹¾æ·¨
  },

  dayGridMonth: {
    type: 'multiMonthMonth',   // æ­£ç¢ºçš„å¤šæœˆä»½æœˆè¦–åœ–å‹åˆ¥
    duration: { months: 4 },   // å¯¦éš›é¡¯ç¤º 3 å€‹æœˆä»½
    multiMonthMaxColumns: 2,   // æ¯åˆ—æœ€å¤š 3 æ¬„ï¼ˆä¸æ±ºå®šé¡¯ç¤ºå¹¾å€‹æœˆï¼‰
    eventDisplay: 'none',
    displayEventTime: false
  }
}, // <--- views å€å¡Šåˆ°æ­¤çµæŸ


selectable: true,


// æœˆè¦–åœ–ï¼šé»æ—¥æœŸ â†’ è·³åˆ°è©²å¤©çš„æ—¥è¦–åœ–ï¼›æ—¥/é€±è¦–åœ–ï¼šè¼•é»ç«‹å³é–‹æ–°å¢è¦–çª—
dateClick: function(info){
  if (info.view.type === 'dayGridMonth') {
  calendar.changeView('resourceTimeGridDay', info.date);
  return;
}
  if (info.view.type === 'resourceTimeGridDay' || info.view.type === 'resourceTimeGridWeek') {
  if (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) return; // æ‰‹æ©Ÿï¼šæ”¹ç”±é•·æŒ‰(select)è§¸ç™¼
  openApptModalForCreate(info.date, info.resource); // æ¡Œé¢ä»ç¶­æŒé»ä¸€ä¸‹é–‹çª—
}
},

// æœˆè¦–åœ–ï¼šä¾æ˜ŸæœŸé¡¯ç¤ºå›ºå®šä¼‘å‡åº•è‰²ï¼ˆå«æ–‡å­—ï¼šé€±ä¸€=å…¬ä¼‘ã€é€±å››=åº—é•·ä¼‘ï¼‰
dayCellDidMount: function(arg){
  if (arg.view.type !== 'dayGridMonth') return;
  const d = arg.date.getDay(); // 0æ—¥ 1ä¸€ 2äºŒ 3ä¸‰ 4å›› 5äº” 6å…­
  if (d === 1) arg.el.classList.add('closed-day-bg');   // å…¨åº—å…¬ä¼‘ï¼ˆé¡¯ç¤ºã€Œå…¬ä¼‘ã€æ–‡å­—ï¼‰
  if (d === 4) arg.el.classList.add('leave-boss');      // åº—é•·ä¼‘ï¼ˆé¡¯ç¤ºã€Œåº—é•·ä¼‘ã€æ–‡å­—ï¼‰
  if (d === 0) arg.el.classList.add('leave-yatting');   // é›…å©·ä¼‘ï¼ˆåƒ…åº•è‰²ï¼‰
  if (d === 2) arg.el.classList.add('leave-xiaobai');   // å°ç™½ä¼‘ï¼ˆåƒ…åº•è‰²ï¼‰
},

selectable: true,
selectLongPressDelay: 0, // ã€æ–°å¢ã€‘æ‰‹æ©Ÿè¼•é»ç›´æ¥è§¸ç™¼ selectï¼Œä¸éœ€é•·æŒ‰ï¼Œæ¸›å°‘å½ˆçª—å»¶é²

datesSet: function(info) {
  updateToolbarTitle(info);
  syncTimeLabelClosedBg(info);
  paintMondayClosed(info);
  paintEmployeeLeave();
  currentYmd = ymd(info.start);
  fetchDailyNote(currentYmd);
},

        resourceLabelDidMount: function(arg) {
  const cushionEl = arg.el.querySelector('.fc-col-header-cell-cushion');
  if (!cushionEl) return;

  // ğŸ“… æ’ä¼‘
  const leaveIconButton = document.createElement('span');
  leaveIconButton.className = 'leave-icon-button';
  leaveIconButton.textContent = '';
  cushionEl.appendChild(leaveIconButton);
  leaveIconButton.addEventListener('mousedown', function(event) {
    event.stopPropagation();
    setTimeout(() => { openLeaveModal(calendar.view.currentStart, arg.resource); }, 0);
  });

  // âœ… ç´„æ»¿ï¼ˆåˆ‡æ›ï¼‰
  const dStr = ymd(calendar.view.currentStart);
  const isFB = Array.isArray(employeeLeaveData) &&
    employeeLeaveData.some(l => l.date === dStr && l.resourceId === arg.resource.id && l.reason === 'å·²ç´„æ»¿');

  const fbBtn = document.createElement('span');
  fbBtn.className = 'fully-booked-button' + (isFB ? ' fb-active' : '');
  fbBtn.textContent = '';
  cushionEl.appendChild(fbBtn);

  fbBtn.addEventListener('click', async (e) => {
    e.stopPropagation();
    const date = ymd(calendar.view.currentStart);
    const resourceId = arg.resource.id;
    try {
      if (fbBtn.classList.contains('fb-active')) {
        // å–æ¶ˆç´„æ»¿
        const res = await fetch(APPS_SCRIPT_WEB_APP_URL, {
          method:'POST', mode:'cors',
          body: JSON.stringify({ action:'deleteLeave', resourceId, date })
        });
        const j = await res.json(); if (j.status !== 'success') throw new Error(j.message);
        // æ›´æ–°å¿«å–
        if (Array.isArray(employeeLeaveData)) {
          const i = employeeLeaveData.findIndex(l => l.date===date && l.resourceId===resourceId && l.reason==='å·²ç´„æ»¿');
          if (i !== -1) employeeLeaveData.splice(i,1);
        }
        fbBtn.classList.remove('fb-active'); fbBtn.textContent = '';
      } else {
        // è¨­ç‚ºç´„æ»¿
        const res = await fetch(APPS_SCRIPT_WEB_APP_URL, {
          method:'POST', mode:'cors',
          body: JSON.stringify({ action:'saveLeave', resourceId, date, reason:'å·²ç´„æ»¿' })
        });
        const j = await res.json(); if (j.status !== 'success') throw new Error(j.message);
        if (Array.isArray(employeeLeaveData)) {
          employeeLeaveData.push({ date, resourceId, reason:'å·²ç´„æ»¿' });
        }
        fbBtn.classList.add('fb-active'); fbBtn.textContent = '';
      }
      // ç«‹å³é‡ç¹ªæ¬„ä½æ¨£å¼
      paintEmployeeLeave();
    } catch(err) {
      alert('åˆ‡æ›ç´„æ»¿å¤±æ•—ï¼š' + err.message);
    }
  });
},


        eventClick: function(info) { openApptModalForEdit(info.event); },
        select: function(info) { openApptModalForCreate(info.start, info.resource); },

        eventContent: function(arg) {
             const ep = arg.event.extendedProps || {};
             const svcMap = { 'å‰ªé«®': 'å‰ª', 'å‰ª+æŸ“': 'å‰ª æŸ“', 'å‰ª+ç‡™': 'å‰ª ç‡™', 'å‰ª+æŸ“+ç‡™': 'å‰ª æŸ“ ç‡™', 'å‰ª+é ­çš®è­·ç†': 'å‰ª è­·' };
             const svc = ep.appointment_type === 'blocked' ? 'ğŸš«' : (svcMap[ep.service_id] || 'é ');
             return {
              html: `<div class="fc-event-title evt-line"><span class="evt-svc">${svc}</span><span>${ep.customer_name || ''}</span><span>${ep.notes || ''}</span><span class="evt-phone">${ep.customer_phone || ''}</span></div>`
             };
        },
        
        slotLabelDidMount: function(arg) {
            const m = arg.date.getMinutes();
            arg.el.classList.toggle('slot-major-0030', m === 0 || m === 30);
            arg.el.classList.toggle('slot-minor-1545', m === 15 || m === 45);
        },

        eventClassNames: function(arg) {
            const r = arg.event.getResources();
            const cls = (r && r[0]) ? ['sty-' + r[0].id] : [];
            if (arg.event.extendedProps && arg.event.extendedProps.appointment_type === 'blocked') { 
              cls.push('blocked-time');
            }
            return cls;
        },
      });
      calendar.render();
    }

    async function fetchAllCloudData() {
        try {
            const [leaveRes, notesRes] = await Promise.all([
                fetch(APPS_SCRIPT_WEB_APP_URL + '?action=getLeave'),
                fetch(APPS_SCRIPT_WEB_APP_URL + '?action=getNotes')
            ]);

            if (!leaveRes.ok || !notesRes.ok) {
                throw new Error('ç„¡æ³•å¾å¾Œç«¯ç²å–è³‡æ–™');
            }

            employeeLeaveData = await leaveRes.json();
            paintEmployeeLeave();

        } catch (error) {
            console.error('è®€å–é›²ç«¯è³‡æ–™å¤±æ•—:', error);
            alert('è®€å–é›²ç«¯è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–å¾Œç«¯è¨­å®šã€‚');
        }
    }
    
    function bindEventListeners() {
        phoneEl.addEventListener('input', (e) => {
          let d = e.target.value.replace(/\D/g,'').slice(0,10);
          if (d.length >= 7) e.target.value = d.replace(/^(\d{4})(\d{3})(\d{0,3}).*$/, function(_,a,b,c){ return c ? `${a}-${b}-${c}` : `${a}-${b}` });
          else if (d.length >= 5) e.target.value = d.replace(/^(\d{4})(\d{0,3}).*$/, '$1-$2');
          else e.target.value = d;
        });

        let notesSaveTimeout;
        notesTextarea.addEventListener('input', function () {
  document.querySelector('.notes-meta span').textContent = 'æœªå„²å­˜';
});
     
document.getElementById('save-notes-btn').addEventListener('click', async function(){
  const meta = document.querySelector('.notes-meta span');
  meta.textContent = 'å„²å­˜ä¸­...';
  try{
    const payload = { 
      action:'saveNotes', 
      date: currentYmd || ymd(new Date()),
      content: notesTextarea.value 
    };
    const r = await fetch(APPS_SCRIPT_WEB_APP_URL, {
      method:'POST', 
      mode:'cors', 
      body: JSON.stringify(payload)
    });
    const j = await r.json();
    if (j.status !== 'success') {
      throw new Error(j.message || 'å¯«å…¥å¤±æ•—');
    }
    meta.textContent = 'å·²å„²å­˜ âœ“';
  } catch (e) { 
    meta.textContent = 'å„²å­˜å¤±æ•— âŒ'; 
  }
});

        
        leaveForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const payload = {
                action: 'saveLeave',
                resourceId: document.getElementById('leaveResourceId').value,
                date: document.getElementById('leaveDate').value,
                reason: document.getElementById('leaveReason').value.trim() || 'æ’ä¼‘'
            };
            try {
                const res = await fetch(APPS_SCRIPT_WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload), mode: 'cors' });
                const result = await res.json();
                if (result.status !== 'success') throw new Error(result.message);
                calendar.refetchEvents(); // âœ… é€šçŸ¥ FullCalendar é‡æ–°å–å¾—æ‰€æœ‰äº‹ä»¶
                leaveModal.style.display = 'none';

            } catch (error) {
                alert('å„²å­˜æ’ä¼‘å¤±æ•—: ' + error.message);
            }
        });

        deleteLeaveBtn.addEventListener('click', async function() {
            if (!confirm('ç¢ºå®šè¦å–æ¶ˆé€™ç­†æ’ä¼‘å—ï¼Ÿ')) return;
            const payload = {
                action: 'deleteLeave',
                resourceId: document.getElementById('leaveResourceId').value,
                date: document.getElementById('leaveDate').value
            };
            try {
                const res = await fetch(APPS_SCRIPT_WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload), mode: 'cors' });
                const result = await res.json();
                if (result.status !== 'success') throw new Error(result.message);
                calendar.refetchEvents(); // âœ… é€šçŸ¥ FullCalendar é‡æ–°å–å¾—æ‰€æœ‰äº‹ä»¶
                leaveModal.style.display = 'none';

            } catch (error) {
                alert('åˆªé™¤æ’ä¼‘å¤±æ•—: ' + error.message);
            }
        });
        
        calendarEl.addEventListener('click', function(e) {
            if (e.target.matches('.leave-overlay')) {
                const { resourceId, date } = e.target.dataset;
                const resource = calendar.getResourceById(resourceId);
                if(resource) { openLeaveModal(new Date(date + 'T00:00:00'), resource); }
            }
        });

        form.addEventListener('submit', async function (e) {
          e.preventDefault();
          const isEditing = !!eventIdInput.value;
          const fd = new FormData(form);
          const payload = {
            action: isEditing ? 'edit' : 'create',
            id: fd.get('event_id') || undefined,
            employee_id: fd.get('employee_id'),
            start: fd.get('start_time'),
            appointment_type: fd.get('appointment_type'),
            customer_name: fd.get('customer_name') || '',
            customer_phone: (fd.get('customer_phone') || '').replace(/\D/g,''),
            service_id: fd.get('service_id') || '',
            notes: fd.get('notes') || ''
          };
          submitBtn.disabled = true;
          try {
            const res = await fetch(APPS_SCRIPT_WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload), mode: 'cors' });
            const data = await res.json();
            if (!res.ok || data.status !== 'success') throw new Error(data.message || 'å„²å­˜å¤±æ•—');
          } catch (err) {
            alert('âŒ å„²å­˜å¤±æ•—ï¼š' + err.message);
          } finally {
            submitBtn.disabled = false;
            appointmentModal.style.display = 'none';
            calendar.refetchEvents();
          }
        });

        deleteBtn.onclick = async function () {
          const eventId = eventIdInput.value.trim();
          if (!eventId || !confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†é ç´„å—ï¼Ÿ')) return;
          try {
            const res = await fetch(APPS_SCRIPT_WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', id: eventId }), mode: 'cors' });
            const data = await res.json();
            if (!res.ok || data.status !== 'success') throw new Error(data.message || 'åˆªé™¤å¤±æ•—');
          } catch (err) {
            alert('âŒ åˆªé™¤å¤±æ•—ï¼š' + err.message);
          } finally {
            appointmentModal.style.display = 'none';
            calendar.refetchEvents();
          }
        };

        appointmentCloseButton.onclick = () => appointmentModal.style.display = 'none';
        leaveCloseButton.onclick = () => leaveModal.style.display = 'none';
        window.addEventListener('click', (e) => {
          if (e.target === appointmentModal || e.target === leaveModal) {
            appointmentModal.style.display = 'none';
            leaveModal.style.display = 'none';
          }
        });

        document.querySelectorAll('input[name="appointment_type"]').forEach(radio => {
          radio.addEventListener('change', function() {
            const isBlocked = this.value === 'blocked';
            customerFields.style.display = isBlocked ? 'none' : 'block';
            document.getElementById('notes').placeholder = isBlocked ? 'ä¸ç´„æ™‚æ®µå‚™è¨»...' : 'è«‹è¼¸å…¥å‚™è¨»è³‡è¨Š...';
            const isEditing = !!eventIdInput.value;
            if (isBlocked) {
                submitBtn.innerHTML = 'ğŸš« è¨­å®šä¸ç´„æ™‚æ®µ';
            } else {
                submitBtn.innerHTML = isEditing ? 'âœ… æ›´æ–°é ç´„' : 'ğŸ’¾ å„²å­˜é ç´„';
            }
          });
        });
    }

    function paintEmployeeLeave() {
  // å…ˆæ¸…æ‰èˆŠå±¤
  document.querySelectorAll('#calendar .leave-overlay').forEach(n => n.remove());
  document.querySelectorAll('#calendar .fully-booked-outline').forEach(n => n.remove());
  if (!Array.isArray(employeeLeaveData)) return;

  employeeLeaveData.forEach(leave => {
    const targetColumn = document.querySelector(
      `#calendar .fc-timegrid-col[data-date="${leave.date}"][data-resource-id="${leave.resourceId}"]`
    );
    if (!targetColumn) return;

    if (leave.reason === 'å·²ç´„æ»¿') {
      // åªç•«å¤–æ¡†ï¼Œä¸è¦†è“‹å…§å®¹
      const o = document.createElement('div');
      o.className = 'fully-booked-outline';
      targetColumn.appendChild(o);
      return;
    }

    const ov = document.createElement('div');
    ov.className = 'closed-overlay leave-overlay';
    ov.textContent = leave.reason;
    ov.dataset.resourceId = leave.resourceId;
    ov.dataset.date = leave.date;
    targetColumn.appendChild(ov);
  });
}



    function openLeaveModal(date, resource) {
        const ymd = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        const dateStr = ymd(date);
        const existingLeave = Array.isArray(employeeLeaveData) ? employeeLeaveData.find(l => l.date === dateStr && l.resourceId === resource.id) : null;
        document.getElementById('leaveResourceId').value = resource.id;
        document.getElementById('leaveDate').value = dateStr;
        document.getElementById('leaveModalResourceName').textContent = resource.title;
        document.getElementById('leaveModalDate').textContent = dateStr;
        document.getElementById('leaveReason').value = existingLeave ? existingLeave.reason : resource.title + 'æ’ä¼‘';
        deleteLeaveBtn.style.display = existingLeave ? 'inline-block' : 'none';
        leaveModal.style.display = 'block';
    }

    function openApptModalForCreate(startDate, resource) {
      if (!resource) return;
      form.reset();
      eventIdInput.value = '';
      submitBtn.innerHTML = 'ğŸ’¾ å„²å­˜é ç´„';
      deleteBtn.style.display = 'none';
      document.querySelector('input[name="appointment_type"][value="normal"]').checked = true;
      customerFields.style.display = 'block';
      document.getElementById('notes').placeholder = 'è«‹è¼¸å…¥å‚™è¨»è³‡è¨Š.';
      document.getElementById('employee_id').value = resource.id;
      const minuteSelect = document.getElementById('minute_select');
      minuteSelect.innerHTML = '';
      const baseMin = startDate.getMinutes();
      for (let i = 0; i < 3; i++) { 
        const currentMinute = baseMin + (i * 5); 
        const opt = document.createElement('option');
        opt.value = currentMinute; 
        opt.textContent = String(currentMinute).padStart(2, '0');
        if (i === 0) opt.selected = true;
        minuteSelect.appendChild(opt);
      }
      updateHiddenStartTime(startDate);
      minuteSelect.onchange = function() { updateHiddenStartTime(startDate) };
      appointmentModal.style.display = 'block';
    }

    function openApptModalForEdit(event) {
        form.reset();
        const ep = event.extendedProps || {};
        eventIdInput.value = event.id;
        deleteBtn.style.display = 'inline-block';
        const rs = event.getResources();
        document.getElementById('employee_id').value = (rs && rs[0] ? rs[0].id : '');
        document.getElementById('customer_phone').value = ep.customer_phone || '';
        document.getElementById('customer_name').value  = ep.customer_name  || '';
        document.getElementById('service_id').value    = ep.service_id    || '';
        document.getElementById('notes').value         = ep.notes         || '';
        const isBlocked = ep.appointment_type === 'blocked';
        document.querySelector(`input[name="appointment_type"][value="${isBlocked ? 'blocked' : 'normal'}"]`).checked = true;
        customerFields.style.display = isBlocked ? 'none' : 'block';
        submitBtn.innerHTML = isBlocked ? 'ğŸš« æ›´æ–°ä¸ç´„æ™‚æ®µ' : 'âœ… æ›´æ–°é ç´„';
        const startDate = event.start;
        const minuteSelect = document.getElementById('minute_select');
        minuteSelect.innerHTML = '';
        const startMinute = startDate.getMinutes();
        for (let m = 0; m < 60; m += 5) {
          const opt = document.createElement('option');
          opt.value = m;
          opt.textContent = String(m).padStart(2, '0');
          if (m === startMinute) opt.selected = true;
          minuteSelect.appendChild(opt);
        }
        updateHiddenStartTime(startDate);
        minuteSelect.onchange = function() { updateHiddenStartTime(startDate) };
        appointmentModal.style.display = 'block';
    }

    function updateHiddenStartTime(baseDate) {
      const selectedMinute = parseInt(document.getElementById('minute_select').value, 10);
      const dt = new Date(baseDate.getTime());
      dt.setMinutes(selectedMinute, 0, 0);
      document.getElementById('start_time').value = dt.toISOString();
    }
  
    function updateToolbarTitle(info) {
  const el = document.querySelector('#calendar .fc-toolbar-title');
  if (!el || !info || !info.view) return;

  const type = info.view.type;
  const d = info.view.currentStart;
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const day = d.getDate();
  const wdMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];

  if (type === 'dayGridMonth') {
    el.classList.add('is-month-title');
    el.innerHTML = `<span class="title-month-text">${y} å¹´ ${m} æœˆ</span>`;
    return;
  }

  el.classList.remove('is-month-title');
  if (type === 'resourceTimeGridDay') {
    el.textContent = `${y} å¹´ ${m} æœˆ ${day} æ—¥ < ${wdMap[d.getDay()]} >`;
  } else {
    el.textContent = info.view.title;
  }
}


    function syncTimeLabelClosedBg(info) {
      const cal = document.getElementById('calendar');
      if (!cal) return;
      cal.classList.remove('is-closed-day');
      const isDayView = info && info.view && info.view.type === 'resourceTimeGridDay';
      if (isDayView && info.start && info.start.getDay() === 1) {
        cal.classList.add('is-closed-day');
      }
    }

    function paintMondayClosed(info){
      document.querySelectorAll('#calendar .closed-overlay:not(.leave-overlay)').forEach(n => n.remove());
      const start = info.start, end = info.end;
      const ymd = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      for (let d = new Date(start); d < end; d.setDate(d.getDate()+1)) {
        if (d.getDay() !== 1) continue;
        const dateStr = ymd(d);
        document.querySelectorAll(`#calendar .fc-timegrid-col[data-date="${dateStr}"]`).forEach(col => {
          const ov = document.createElement('div');
          ov.className = 'closed-overlay';
          ov.textContent = 'å…¬ä¼‘';
          col.appendChild(ov);
        });
      }
    }
});
})();
  </script>  
  </body>
 </html>

